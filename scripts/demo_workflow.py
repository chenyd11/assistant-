#!/usr/bin/env python3
"""
å®Œæ•´å·¥ä½œæµç¤ºä¾‹ï¼šè§†é¢‘å…¥åº“ â†’ æ´—ç¨¿ â†’ ç”Ÿæˆå¤šå¹³å°ç‰ˆæœ¬ â†’ ä¿å­˜åˆ°åº“
"""

import sys
sys.path.insert(0, '/Users/chenyd11/.openclaw/workspace/library')

from video_lib import VideoLibrary
from rewrite_manager import RewriteVersionManager

def demo_workflow():
    """æ¼”ç¤ºå®Œæ•´å·¥ä½œæµ"""
    
    print("=" * 70)
    print("ğŸ¬ å®Œæ•´å·¥ä½œæµæ¼”ç¤ºï¼šè§†é¢‘å…¥åº“ â†’ æ´—ç¨¿ â†’ å¤šå¹³å°ç‰ˆæœ¬")
    print("=" * 70)
    print()
    
    # ========== ç¬¬1æ­¥ï¼šè§†é¢‘å…¥åº“ ==========
    print("ğŸ“¥ æ­¥éª¤1: è§†é¢‘å…¥åº“ï¼ˆå·²å®Œæˆï¼‰")
    print("-" * 70)
    
    video_lib = VideoLibrary()
    video_id = "VID_2026_0001_76d70ac1"  # å·²å­˜åœ¨çš„è§†é¢‘
    video = video_lib._get_video(video_id)
    
    print(f"è§†é¢‘ç¼–å·: {video_id}")
    print(f"æ ‡é¢˜: {video['title']}")
    print(f"çŠ¶æ€: {video['status']}")
    print(f"å·²åŒæ­¥åˆ°Bitableä¸»è¡¨ âœ…")
    print()
    
    # è·å–è½¬å½•æ–‡æœ¬
    transcript = video_lib.get_transcript(video_id)
    print("è½¬å½•æ–‡æœ¬é¢„è§ˆï¼ˆå‰200å­—ï¼‰:")
    print(transcript[:200] + "...")
    print()
    
    # ========== ç¬¬2æ­¥ï¼šæ´—ç¨¿ç”Ÿæˆå¤šå¹³å°ç‰ˆæœ¬ ==========
    print("âœï¸  æ­¥éª¤2: æ´—ç¨¿ç”Ÿæˆå¤šå¹³å°ç‰ˆæœ¬")
    print("-" * 70)
    
    # æ¨¡æ‹Ÿæ´—ç¨¿åçš„å†…å®¹ï¼ˆå®é™…ä¼šç”±AIç”Ÿæˆï¼‰
    versions = [
        {
            "platform": "å…¬ä¼—å·",
            "account": "æˆ‘çš„å…¬ä¼—å·",
            "title": "ä»'é»‘ä¸­ä»‹'æ‰‹ä¸­æ­»é‡Œé€ƒç”Ÿï¼šä¸€ä¸ªæ‰“å·¥äººçš„9æ¡ä¿å‘½æ³•åˆ™",
            "content": """è¿›å‚æ‰“å·¥ï¼Œè¿™9ä¸ªé—®é¢˜ä¸é—®æ¸…æ¥šï¼Œç­‰ç€è¢«å‘ï¼

ç¬¬ä¸€ï¼Œå‚åå«ä»€ä¹ˆï¼Ÿä¸æ•¢è¯´çš„ç›´æ¥æ‹‰é»‘ã€‚

ç¬¬äºŒï¼Œåœ°å€åœ¨å“ªï¼Ÿå†™å­—æ¥¼é¢è¯•ã€åœ°é“å£é›†åˆçš„éƒ½æ˜¯ä¸­ä»‹å¥—è·¯ã€‚

ç¬¬ä¸‰ï¼Œå·¥èµ„æ€ä¹ˆç®—ï¼Ÿçº¯å·¥ä»·è¿˜æ˜¯è¡¥å·®ä»·ï¼ŸåˆåŒé€å­—çœ‹ï¼Œåˆ«æ‰é™·é˜±ã€‚

...ï¼ˆå®Œæ•´å†…å®¹çº¦1500å­—ï¼‰""",
            "tags": ["æ‰“å·¥", "é¿å‘", "èŒåœº"]
        },
        {
            "platform": "å°çº¢ä¹¦",
            "account": "ä¸ªäººç”Ÿæ´»å·",
            "title": "âš ï¸ æ‰¾å·¥å‚å·¥ä½œå‰å¿…é—®çš„9ä¸ªé—®é¢˜ï¼é»‘ä¸­ä»‹é€€é€€é€€ï¼ğŸ’¢",
            "content": """å§å¦¹ä»¬ï¼è¿‡å®Œå¹´åˆè¦å‡ºæ¥æ‰¾å·¥ä½œäº†å§ï¼ŸğŸ˜­
ä»Šå¤©åˆ†äº«9ä¸ªä¸€å®šè¦é—®æ¸…æ¥šçš„é—®é¢˜ï¼
é—®å®Œè¿™äº›ï¼Œé»‘ä¸­ä»‹ç›´æ¥ç°åŸå½¢ï¼âœ¨

â¶ å‚åå«ä»€ä¹ˆï¼Ÿ
è¿åå­—éƒ½ä¸æ•¢è¯´çš„ï¼Œç›´æ¥æ‹‰é»‘åˆ é™¤ğŸ‘‹

â· åœ°å€åœ¨å“ªï¼Ÿ
âš ï¸ è­¦æƒ•è¿™äº›åœ°ç‚¹ï¼š
âŒ å†™å­—æ¥¼é¢è¯•
âŒ åœ°é“å£é›†åˆ
âŒ "ä¼ä¸šæ¥å¾…å¤„"æŒ‚ç‰Œ

...ï¼ˆå®Œæ•´å†…å®¹çº¦500å­—ï¼‰""",
            "tags": ["æ‰“å·¥äºº", "æ‰¾å·¥ä½œ", "é¿å‘æŒ‡å—"]
        },
        {
            "platform": "å°çº¢ä¹¦",
            "account": "èŒåœºå¹²è´§å·",
            "title": "è¿›å‚å‰ä¸é—®è¿™9ä¸ªé—®é¢˜çš„ï¼Œéƒ½è¢«å‘æƒ¨äº†ğŸ˜­",
            "content": """è¿›å‚æ‰“å·¥é¿å‘æŒ‡å—ï¼ŒèŒåœºæ–°äººå¿…çœ‹ï¼

1ï¸âƒ£ å‚åæ ¸å®
2ï¸âƒ£ åœ°å€ç¡®è®¤  
3ï¸âƒ£ å·¥èµ„ç»“æ„
4ï¸âƒ£ è´¹ç”¨æ˜ç»†
5ï¸âƒ£ å‘è–ªæ—¥æœŸ
6ï¸âƒ£ é£Ÿå®¿æ¡ä»¶
7ï¸âƒ£ å·¥èµ„æ¡
8ï¸âƒ£ å·¥æœŸè¦æ±‚
9ï¸âƒ£ å·¥ä½œæ¨¡å¼

è¯¦ç»†è§£æçœ‹å›¾ğŸ‘†
æ”¶è—èµ·æ¥ï¼Œæ‰¾å·¥ä½œå‰æ‹¿å‡ºæ¥å¯¹ç…§é—®ï¼""",
            "tags": ["èŒåœºæ–°äºº", "æ±‚èŒæ”»ç•¥", "å¹²è´§åˆ†äº«"]
        },
        {
            "platform": "æŠ–éŸ³",
            "account": "ä¸»è´¦å·",
            "title": "è¿›å‚å‰ä¸é—®è¿™9ä¸ªï¼Œè¢«éª—åˆ«æ€ªæˆ‘æ²¡æé†’ä½ ï¼",
            "content": """âš ï¸ æ‰¾å·¥å‚å·¥ä½œï¼Œè¿™9ä¸ªé—®é¢˜ä¸é—®=é€é’±ç»™é»‘ä¸­ä»‹ï¼

1ï¸âƒ£ å‚åæ˜¯ä»€ä¹ˆï¼Ÿ ä¸æ•¢è¯´çš„ç›´æ¥åˆ ï¼
2ï¸âƒ£ åœ°å€åœ¨å“ªï¼Ÿ å†™å­—æ¥¼/åœ°é“å£=ä¸­ä»‹å¥—è·¯ï¼
3ï¸âƒ£ å·¥èµ„æ€ä¹ˆç®—ï¼Ÿ çº¯å·¥ä»·vsè¡¥å·®ä»·ï¼Ÿ
4ï¸âƒ£ è´¹ç”¨å¤šå°‘ï¼Ÿ æŠ¼é‡‘ï¼Ÿä½“æ£€è´¹ï¼Ÿ
5ï¸âƒ£ å•¥æ—¶å€™å‘é’±ï¼Ÿ ç¦»èŒå3å¤©å†…æ­£å¸¸
6ï¸âƒ£ åƒä½çœŸåŒ…å—ï¼Ÿ é—®æ¸…æ¥šæ˜¯çº¯åŒ…è¿˜æ˜¯é¤è¡¥
7ï¸âƒ£ å·¥æœŸå¤šä¹…ï¼Ÿ åšä¸åˆ°æ€ä¹ˆç®—ï¼Ÿ
8ï¸âƒ£ é•¿ç™½ç­è¿˜æ˜¯ä¸¤ç­å€’ï¼Ÿ ç«™ç€è¿˜æ˜¯åç€ï¼Ÿ
9ï¸âƒ£ ç©¿æ— å°˜æœå—ï¼Ÿ èº«ä½“æ‰›å¾—ä½å—ï¼Ÿ

ğŸ’¡ é—®å®Œè¿™9ä¸ªï¼Œ99%é»‘ä¸­ä»‹åŸå½¢æ¯•éœ²ï¼""",
            "tags": ["è¿›å‚æ‰“å·¥", "é¿å‘æŒ‡å—"]
        },
        {
            "platform": "æŠ–éŸ³",
            "account": "å°å·",
            "title": "è¿›å‚æ‰“å·¥é¿å‘ï¼è¿™9ä¸ªé—®é¢˜å¿…é—®ï¼",
            "content": """ğŸ”¥ è¿›å‚æ‰“å·¥é¿å‘æŒ‡å—ï¼9ä¸ªé—®é¢˜ä¸é—®=è¢«å‘ï¼

ğŸš¨ é»‘ä¸­ä»‹å¸¸ç”¨å¥—è·¯ï¼š
- å†™å­—æ¥¼é¢è¯• âŒ
- åœ°é“å£é›†åˆ âŒ  
- æ”¶æŠ¼é‡‘ä½“æ£€è´¹ âŒ

âœ… æ­£è§„å‚æ ‡å‡†ï¼š
- å‚ååœ°å€é€æ˜
- å·¥èµ„ç»“æ„æ¸…æ™°
- æä¾›å…è´¹é£Ÿå®¿
- æŒ‰æ—¶å‘å·¥èµ„

ğŸ’¡ è®°ä½è¿™9é—®ï¼Œè½»æ¾é¿å‘ï¼

#è¿›å‚æ‰“å·¥ #é¿å‘æŒ‡å— #æ‰“å·¥äºº""",
            "tags": ["æ‰“å·¥", "æ±‚èŒ"]
        }
    ]
    
    # ========== ç¬¬3æ­¥ï¼šä¿å­˜åˆ°æ”¹å†™ç‰ˆæœ¬åº“ ==========
    print("ğŸ’¾ æ­¥éª¤3: ä¿å­˜åˆ°æ”¹å†™ç‰ˆæœ¬åº“ï¼ˆæœ¬åœ° + Bitableå­è¡¨ï¼‰")
    print("-" * 70)
    
    rewrite_mgr = RewriteVersionManager()
    
    created_versions = []
    for v in versions:
        version_id = rewrite_mgr.add_version(
            video_id=video_id,
            platform=v["platform"],
            account=v["account"],
            title=v["title"],
            content=v["content"],
            tags=v["tags"],
            notes="AIè‡ªåŠ¨ç”Ÿæˆï¼Œå¾…å®¡æ ¸"
        )
        created_versions.append(version_id)
    
    print()
    print(f"âœ… å…±ç”Ÿæˆ {len(created_versions)} ä¸ªæ”¹å†™ç‰ˆæœ¬")
    print()
    
    # ========== ç¬¬4æ­¥ï¼šæ˜¾ç¤ºç‰ˆæœ¬ç»Ÿè®¡ ==========
    print("ğŸ“Š æ­¥éª¤4: ç‰ˆæœ¬ç»Ÿè®¡")
    print("-" * 70)
    
    rewrite_mgr.print_summary()
    
    # æ˜¾ç¤ºè¯¥è§†é¢‘çš„æ‰€æœ‰ç‰ˆæœ¬
    print()
    print(f"è§†é¢‘ {video_id} çš„æ”¹å†™ç‰ˆæœ¬:")
    video_versions = rewrite_mgr.get_versions_by_video(video_id)
    for v in video_versions:
        print(f"  - {v['version_id']}: {v['platform']} - {v['account']} ({v['word_count']}å­—) [{v['status']}]")
    
    # ========== ç¬¬5æ­¥ï¼šåç»­æ“ä½œç¤ºä¾‹ ==========
    print()
    print("ğŸ”„ æ­¥éª¤5: åç»­æ“ä½œï¼ˆç¤ºä¾‹ï¼‰")
    print("-" * 70)
    print()
    print("æ“ä½œé€‰é¡¹:")
    print("  1. ç¼–è¾‘æŸä¸ªç‰ˆæœ¬ â†’ ä¿®æ”¹å†…å®¹")
    print("  2. å‘å¸ƒç‰ˆæœ¬ â†’ æ›´æ–°çŠ¶æ€ä¸º'å·²å‘å¸ƒ'")
    print("  3. æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬ â†’ æŒ‰å¹³å°/çŠ¶æ€ç­›é€‰")
    print()
    
    # ç¤ºä¾‹ï¼šæ›´æ–°ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸ºå·²å‘å¸ƒ
    if created_versions:
        print(f"ç¤ºä¾‹: å°† {created_versions[0]} æ ‡è®°ä¸ºå·²å‘å¸ƒ")
        rewrite_mgr.update_status(
            created_versions[0], 
            "å·²å‘å¸ƒ",
            publish_link="https://mp.weixin.qq.com/s/example"
        )
    
    # ========== ç¬¬6æ­¥ï¼šBitableæ•°æ®ç»“æ„ ==========
    print()
    print("=" * 70)
    print("ğŸ“‹ Bitableæ•°æ®ç»“æ„")
    print("=" * 70)
    print()
    
    print("ã€ä¸»è¡¨ï¼šè§†é¢‘åº“ã€‘")
    print("  è§†é¢‘ç¼–å· | æ ‡é¢˜ | çŠ¶æ€ | è½¬å½•æ–‡å­—")
    print(f"  {video_id} | {video['title'][:20]}... | å·²è½¬å½• | ï¼ˆè½¬å½•å†…å®¹ï¼‰")
    print()
    
    print("ã€å­è¡¨ï¼šæ”¹å†™ç‰ˆæœ¬åº“ã€‘")
    print("  ç‰ˆæœ¬ç¼–å· | å…³è”è§†é¢‘ç¼–å· | å¹³å° | è´¦å· | æ ‡é¢˜ | çŠ¶æ€")
    for v in video_versions:
        print(f"  {v['version_id']} | {v['video_id'][:15]}... | {v['platform']} | {v['account']} | {v['title'][:15]}... | {v['status']}")
    
    print()
    print("=" * 70)
    print("âœ… æ¼”ç¤ºå®Œæˆï¼")
    print("=" * 70)
    print()
    print("ä¸‹ä¸€æ­¥:")
    print("  1. åœ¨é£ä¹¦Bitableåˆ›å»º'æ”¹å†™ç‰ˆæœ¬åº“'å­è¡¨")
    print("  2. é…ç½®å­—æ®µï¼ˆæŒ‰æ–‡æ¡£ï¼‰")
    print("  3. å‘é€å­è¡¨URLç»™æˆ‘")
    print("  4. é…ç½®è‡ªåŠ¨åŒæ­¥è„šæœ¬")
    print()

if __name__ == "__main__":
    demo_workflow()
